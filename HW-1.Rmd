---
title: "MATH 216 Homework 1"
author: "Carter Merenstein"
output: html_document
---

```{r, echo=FALSE, message=FALSE}
# DO NOT EDIT THIS SECTION
# Load packages

if("ggmap" %in% rownames(installed.packages()) == FALSE) {install.packages("ggmap")}

suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(tidyr))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(ggmap))
```
```{r, echo=FALSE, message=FALSE, cache=TRUE}
# Load data sets. Note this assumes this .Rmd files is in the same directory as
# the .csv files.
flights <- read.csv("data/flights.csv", stringsAsFactors = FALSE) %>% 
 tbl_df() %>%
 mutate(date=as.Date(date))
weather <- read.csv("data/weather.csv", stringsAsFactors = FALSE) %>% 
 tbl_df() %>%
 mutate(date=as.Date(date))
planes <- read.csv("data/planes.csv", stringsAsFactors = FALSE) %>% 
 tbl_df()
airports <- read.csv("data/airports.csv", stringsAsFactors = FALSE) %>% 
 tbl_df()
states <- read.csv("data/states.csv", stringsAsFactors = FALSE) %>% 
 tbl_df()
```







## Admistrative:

Please indicate

* Who you collaborated with: no one
* Roughly how much time you spent on this HW: 6 hr
* What gave you the most trouble: r syntax
* Any comments you have: Learning R is a lot more frustrating than learning other programming languages. I feel like this assignment would have taken 2 hours in any other language but I lost a lot of time figureing out the differences between things like sort(), order(), and arrange(), or n(), count(), tally() and sum(). There also don't seem to be really good documentations for a lot of things. The help() function is not nearly complete as something like man() or the java API. For example, I want a list of all possible options for the stat argument in ggplot, but nothing seeems to just list them.





## Question 1:

* Plot a "time series" of the proportion of flights that were delayed by > 30 minutes on each day.  i.e.
    + the x-axis should be some notion of time
    + the y-axis should be the proportion.
* Which seasons did we tend to see the most and least delays of > 30 minutes.
```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}
q1 = select(flights, `date`, `arr_delay`, `cancelled`)
q1

q1_delay = q1 %>% mutate(arr_delay = ifelse(is.na(arr_delay),31, arr_delay))
#cancled flights are really delayed for more than 30 minues
#q1_delay
q1_delay = na.omit(q1_delay) #now only removes values that are na for both
#View(q1_delay)


delays = group_by(q1_delay, date) %>% summarize(del = sum(arr_delay > 30))
total = group_by(q1_delay, date) %>% summarize(del = n())

#delays
#total

proportion = full_join(total, delays, by="date")
proportion = mutate(proportion, prop = del.y / del.x)
#proportion

p1 = ggplot(proportion, aes(x = date, y = prop))
p1 = p1 + geom_point()
p1



```





## Question 2:

Some people prefer flying on older planes.  Even though they aren't as nice,
they tend to have more room.  Which airlines should these people favor?

```{r, echo=FALSE, fig.width=12, fig.height=6}


q2 = inner_join(planes, flights, by = "plane")
q2 = select(q2, `plane`, `year`, `carrier`)
q2

p2 = ggplot(q2, aes(x = year))
p2 = p2 + geom_histogram()
p2 = p2 + facet_wrap(~carrier)
p2


```
## Question 3:

* What states did listed Southwest Airlines flights tend to fly to?
* What states did all Southwest Airlines flights tend to fly to?

```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}


SW = filter(flights, carrier == "WN")
SW = inner_join(airports, SW, by = c("iata"="dest"))
SW = inner_join(states, SW, by = "state")

q3 = select(SW, `state`, `date`, `iata`, `lat`, `long`)
q3a  = group_by(q3, state) %>% summarize(Flights = n()) ## all flights

q3_map = inner_join(q3a, q3, by = "state")

p_map = qmap("USA", zoom = 4, color = "bw")
p_map = p_map + geom_point(data = q3_map, aes(x = long, y = lat, fill = state, color = "black", size = Flights), pch=21) + scale_shape_identity()
p_map

q3a = arrange(q3a, Flights)
q3a

p3a = ggplot(q3a, aes(x = state, y = Flights)) + geom_bar(stat = "identity")
p3a

q3b = distinct(q3) %>% group_by(state) %>% summarize(Destination_days = n())
q3b
## NEED To fix so it's just by flight

p3b = ggplot(q3b, aes(x = state, y = Destination_days)) + geom_bar(stat = "identity")
p3b


```





## Question 4:

What weather patterns are associated with the biggest departure delays?

```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}

q4 = inner_join(flights, weather, by = c("date", "hour"))

q4_conditions = select(q4, `dep_delay`, `conditions`) %>% group_by(conditions) %>% summarize(`Average delay` = mean(dep_delay), SE = sd(dep_delay)/sqrt(n()))
q4_conditions


p4_conditions = ggplot(q4, aes(x = conditions, y = `dep_delay`)) + geom_point(position = position_jitter(width = 1), size = 0.25)
p4_conditions
## too many points for a jitter plot

p4_conditions_bar = ggplot(q4_conditions, aes(x = conditions, y = `Average delay`)) + geom_bar(stat = "identity")
p4_conditions_bar


```





## Question 5:

I want to know what proportionately regions (NE, south, west, midwest) each 
carrier flies to from Houston in the month of July.  Consider the `month()`
function from the `lubridate` package.

```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}

q5 = mutate(flights, month = month(date, label=TRUE))
q5 = filter(q5, month=="Jul")
q5 = inner_join(q5, airports, by=c("dest" = "iata"))
q5 = inner_join(q5, states, by = "state")
q5 = select(q5, `region`, `carrier`)
q5a = q5 %>% group_by(carrier) %>% summarize(carrier_total = n()) 
q5b = q5 %>% group_by(carrier, region) %>% summarize(region_total = n())
q5 = inner_join(q5a, q5b, by = "carrier") %>% mutate(percent_in_region = (region_total/carrier_total)*100)
q5

p5 = ggplot(q5, aes(x = carrier, y = percent_in_region, fill = factor(region))) + geom_bar(stat = "identity", color = "black")
p5 = p5 + scale_fill_brewer(palette = "Pastel2")
p5


```
